{"version":3,"file":"use-async.modern.js","sources":["../src/utils/debounce.js","../src/use-debounce.js","../src/use-async.js"],"sourcesContent":["export default function debounce(func, wait, immediate) {\n  let timeout;\n  return function () {\n    const context = this;\n    const args = arguments;\n    const later = function () {\n      timeout = null;\n      if (!immediate) func.apply(context, args);\n    };\n    const callNow = immediate && !timeout;\n    clearTimeout(timeout);\n    timeout = setTimeout(later, wait);\n    if (callNow) func.apply(context, args);\n  };\n}\n","import { useCallback } from \"react\";\nimport debounce from \"./utils/debounce\";\n\nexport default function useDebounce(fn, time, dependencies) {\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  return useCallback(debounce(fn, time), dependencies);\n}\n","import {\n  useCallback,\n  useEffect,\n  useMemo,\n  useReducer,\n  useRef,\n  useState,\n} from \"react\";\n\nimport useDebounce from \"./use-debounce\";\n\nconst FUNCTION_PLACEHOLDER = () => {};\n\nconst ASYNC_STATUS = {\n  IDLE: \"idle\",\n  PENDING: \"pending\",\n  SUCCESS: \"success\",\n  ERROR: \"error\",\n};\n\nconst ACTION_TYPES = {\n  START: \"start\",\n  SUCCESS: \"success\",\n  ERROR: \"error\",\n  COMPLETE: \"complete\",\n  RESET: \"reset\",\n  SET_DATA: \"set-data\",\n};\n\nconst API_CANCELED_ERROR = \"canceled\";\n\nconst INITIAL_STATE = {\n  isReset: false,\n  isComplete: false,\n  status: ASYNC_STATUS.IDLE,\n  data: null,\n  error: null,\n};\n\nfunction asyncReducer(state = INITIAL_STATE, { type, payload }) {\n  switch (type) {\n    case ACTION_TYPES.START: {\n      let updatedState = {\n        ...state,\n        status: ASYNC_STATUS.PENDING,\n        isComplete: false,\n      };\n      if (payload.overwrite) {\n        updatedState.data = [];\n      }\n      return updatedState;\n    }\n    case ACTION_TYPES.SUCCESS: {\n      let { data: _data, infinite, overwrite, ...rest } = payload;\n      let data;\n      if (infinite) {\n        if (overwrite) {\n          data = _data;\n        } else {\n          data = [...(state?.data || []), ..._data];\n        }\n      } else {\n        data = payload;\n      }\n      return {\n        ...state,\n        status: ASYNC_STATUS.SUCCESS,\n        data: data,\n        restMeta: rest,\n      };\n    }\n    case ACTION_TYPES.ERROR: {\n      return { ...state, status: ASYNC_STATUS.ERROR, error: payload };\n    }\n    case ACTION_TYPES.COMPLETE: {\n      return { ...state, isComplete: true };\n    }\n    case ACTION_TYPES.RESET: {\n      return { ...state, ...INITIAL_STATE, isComplete: false, isReset: true };\n    }\n    case ACTION_TYPES.SET_DATA: {\n      return { ...state, data: payload };\n    }\n    default: {\n      throw new Error(`Action ${type} is not handled in asyncReducer`);\n    }\n  }\n}\n\nexport default function useAsync(asyncFunction, _config = {}) {\n  const {\n    intialState = {},\n    enabled = true,\n    immediate = true,\n    infinite = false,\n    select,\n    onError = FUNCTION_PLACEHOLDER,\n    onSuccess = FUNCTION_PLACEHOLDER,\n    onStart = FUNCTION_PLACEHOLDER,\n    onComplete = FUNCTION_PLACEHOLDER,\n    debounceTime = 200,\n    withAxiosAbort = false,\n  } = _config;\n\n  //required for React.Strictmode to work\n  const ignoreRef = useRef(false);\n\n  const abortControllerRef = useRef(null);\n\n  const [\n    { isReset, isComplete, status, data, error, restMeta = {} },\n    dispatch,\n  ] = useReducer(asyncReducer, Object.assign({}, INITIAL_STATE, intialState));\n\n  // const [abort, setAbort] = useState(null);\n\n  const setQueryData = useCallback((_data) => {\n    dispatch({\n      type: ACTION_TYPES.SET_DATA,\n      payload: _data,\n    });\n  }, []);\n\n  const execute = useCallback(\n    (args = {}, config = {}) => {\n      (async () => {\n        dispatch({\n          type: ACTION_TYPES.START,\n          payload: { overwrite: config.overwrite },\n        });\n        let _onStart = config?.onStart || onStart;\n\n        let params = args;\n        // if (withAxiosAbort) {\n        // let controller = new AbortController();\n        abortControllerRef.current = new AbortController();\n        params.signal = abortControllerRef.current.signal;\n        // setAbort(controller);\n        // }\n\n        await _onStart();\n        asyncFunction(params)\n          .then(async (res) => {\n            let payload;\n            if (select) {\n              payload = select(res);\n            } else if (infinite) {\n              payload = {\n                data: res?.data?.data,\n                paginate: res?.data?.paginate,\n              };\n            } else {\n              payload = res;\n            }\n\n            payload.overwrite = config.overwrite;\n            payload.infinite = infinite;\n\n            dispatch({ type: ACTION_TYPES.SUCCESS, payload: payload });\n            let _onSuccess = config?.onSuccess || onSuccess;\n            await _onSuccess(payload);\n          })\n          .catch(async (err) => {\n            // IGNORED cancelled  error\n            if (err.message === API_CANCELED_ERROR) return;\n\n            dispatch({\n              type: ACTION_TYPES.ERROR,\n              payload: err?.response || err,\n            });\n            let _onError = config?.onError || onError;\n            await _onError(err);\n          })\n          .finally(async () => {\n            dispatch({ type: ACTION_TYPES.COMPLETE });\n            let _onComplete = config?.onComplete || onComplete;\n            await _onComplete();\n          });\n      })();\n    },\n    [\n      asyncFunction,\n      infinite,\n      onComplete,\n      onError,\n      onStart,\n      onSuccess,\n      select,\n      withAxiosAbort,\n    ]\n  );\n\n  const debounceExecute = useDebounce(execute, debounceTime, [\n    execute,\n    debounceTime,\n  ]);\n\n  const reset = useCallback(() => {\n    dispatch({ type: ACTION_TYPES.RESET });\n  }, []);\n\n  const cancel = useCallback(() => {\n    abortControllerRef?.current?.abort?.();\n  }, []);\n\n  useEffect(() => {\n    if (\n      !ignoreRef.current &&\n      status === ASYNC_STATUS.IDLE &&\n      immediate &&\n      enabled\n    ) {\n      execute();\n    }\n    return () => {\n      ignoreRef.current = true;\n    };\n  }, [enabled, execute, immediate, status]);\n\n  return useMemo(() => {\n    let values = {};\n\n    Object.keys(restMeta).forEach((key) => {\n      values[key] = restMeta[key];\n    });\n\n    return {\n      ...values,\n      data,\n      execute,\n      debounceExecute,\n      setQueryData,\n      error,\n      status,\n      isReset,\n      isComplete,\n      reset,\n      isIdle: status === ASYNC_STATUS.IDLE,\n      isPending: status === ASYNC_STATUS.PENDING,\n      isError: status === ASYNC_STATUS.ERROR,\n      isSuccess: status === ASYNC_STATUS.SUCCESS,\n      cancel,\n    };\n  }, [\n    cancel,\n    data,\n    debounceExecute,\n    error,\n    execute,\n    isComplete,\n    isReset,\n    reset,\n    restMeta,\n    setQueryData,\n    status,\n  ]);\n}\n"],"names":["debounce","func","wait","immediate","timeout","context","args","arguments","later","apply","callNow","clearTimeout","setTimeout","useDebounce","fn","time","dependencies","useCallback","FUNCTION_PLACEHOLDER","ASYNC_STATUS","IDLE","PENDING","SUCCESS","ERROR","ACTION_TYPES","START","COMPLETE","RESET","SET_DATA","API_CANCELED_ERROR","INITIAL_STATE","isReset","isComplete","status","data","error","asyncReducer","state","type","payload","updatedState","overwrite","_data","infinite","rest","restMeta","Error","useAsync","asyncFunction","_config","intialState","enabled","select","onError","onSuccess","onStart","onComplete","debounceTime","withAxiosAbort","ignoreRef","useRef","abortControllerRef","useReducer","Object","assign","dispatch","setQueryData","execute","config","_onStart","params","current","AbortController","signal","then","res","paginate","_onSuccess","err","message","response","_onError","_onComplete","debounceExecute","reset","cancel","abort","useEffect","useMemo","values","keys","forEach","key","isIdle","isPending","isError","isSuccess"],"mappings":"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"}