{"version":3,"file":"index.js","sources":["../src/utils/debounce.js","../src/use-debounce.js","../src/use-async.js"],"sourcesContent":["export default function debounce(func, wait, immediate) {\n  let timeout;\n  return function () {\n    const context = this;\n    const args = arguments;\n    const later = function () {\n      timeout = null;\n      if (!immediate) func.apply(context, args);\n    };\n    const callNow = immediate && !timeout;\n    clearTimeout(timeout);\n    timeout = setTimeout(later, wait);\n    if (callNow) func.apply(context, args);\n  };\n}\n","import { useCallback } from \"react\";\nimport debounce from \"./utils/debounce\";\n\nexport default function useDebounce(fn, time, dependencies) {\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  return useCallback(debounce(fn, time), dependencies);\n}\n","import {\n  useCallback,\n  useEffect,\n  useMemo,\n  useReducer,\n  useRef,\n  useState,\n} from \"react\";\n\nimport useDebounce from \"./use-debounce\";\n\nconst FUNCTION_PLACEHOLDER = () => {};\n\nconst ASYNC_STATUS = {\n  IDLE: \"idle\",\n  PENDING: \"pending\",\n  SUCCESS: \"success\",\n  ERROR: \"error\",\n};\n\nconst ACTION_TYPES = {\n  START: \"start\",\n  SUCCESS: \"success\",\n  ERROR: \"error\",\n  COMPLETE: \"complete\",\n  RESET: \"reset\",\n  SET_DATA: \"set-data\",\n};\n\nconst API_CANCELED_ERROR = \"canceled\";\n\nconst INITIAL_STATE = {\n  isReset: false,\n  isComplete: false,\n  status: ASYNC_STATUS.IDLE,\n  data: null,\n  error: null,\n};\n\nfunction asyncReducer(state = INITIAL_STATE, action = {}) {\n  const { type, payload } = action;\n  switch (type) {\n    case ACTION_TYPES.START: {\n      let updatedState = {\n        ...state,\n        status: ASYNC_STATUS.PENDING,\n        isComplete: false,\n      };\n      if (payload.overwrite) {\n        updatedState.data = [];\n      }\n      return updatedState;\n    }\n    case ACTION_TYPES.SUCCESS: {\n      let { data: _data, infinite, overwrite, ...rest } = payload;\n      let data;\n      if (infinite) {\n        if (overwrite) {\n          data = _data;\n        } else {\n          data = [...(state?.data || []), ..._data];\n        }\n      } else {\n        data = payload;\n      }\n      return {\n        ...state,\n        status: ASYNC_STATUS.SUCCESS,\n        data: data,\n        restMeta: rest,\n      };\n    }\n    case ACTION_TYPES.ERROR: {\n      return { ...state, status: ASYNC_STATUS.ERROR, error: payload };\n    }\n    case ACTION_TYPES.COMPLETE: {\n      return { ...state, isComplete: true };\n    }\n    case ACTION_TYPES.RESET: {\n      return { ...state, ...INITIAL_STATE, isComplete: false, isReset: true };\n    }\n    case ACTION_TYPES.SET_DATA: {\n      return { ...state, data: payload };\n    }\n    default: {\n      throw new Error(`Action ${type} is not handled in asyncReducer`);\n    }\n  }\n}\n\nexport default function useAsync(asyncFunction, _config = {}) {\n  const {\n    intialState = {},\n    enabled = true,\n    immediate = true,\n    infinite = false,\n    select,\n    onError = FUNCTION_PLACEHOLDER,\n    onSuccess = FUNCTION_PLACEHOLDER,\n    onStart = FUNCTION_PLACEHOLDER,\n    onComplete = FUNCTION_PLACEHOLDER,\n    debounceTime = 200,\n  } = _config;\n\n  //required for React.Strictmode to work\n  const ignoreRef = useRef(false);\n\n  const abortControllerRef = useRef(null);\n\n  const [\n    { isReset, isComplete, status, data, error, restMeta = {} },\n    dispatch,\n  ] = useReducer(asyncReducer, Object.assign({}, INITIAL_STATE, intialState));\n\n  const setQueryData = useCallback((_data) => {\n    dispatch({\n      type: ACTION_TYPES.SET_DATA,\n      payload: _data,\n    });\n  }, []);\n\n  const execute = useCallback(\n    (args = {}, config = {}) => {\n      (async () => {\n        dispatch({\n          type: ACTION_TYPES.START,\n          payload: { overwrite: config.overwrite },\n        });\n        abortControllerRef.current = new AbortController();\n        let _onStart = config?.onStart || onStart;\n\n        await _onStart();\n        asyncFunction({ ...args, signal: abortControllerRef.current.signal })\n          .then(async (res) => {\n            let payload;\n            if (select) {\n              payload = select(res);\n            } else if (infinite) {\n              payload = {\n                data: res?.data?.data,\n                paginate: res?.data?.paginate,\n              };\n            } else {\n              payload = res;\n            }\n\n            payload.overwrite = config.overwrite;\n            payload.infinite = infinite;\n\n            dispatch({ type: ACTION_TYPES.SUCCESS, payload: payload });\n            let _onSuccess = config?.onSuccess || onSuccess;\n            await _onSuccess(payload);\n          })\n          .catch(async (err) => {\n            // IGNORED cancelled  error\n            if (err.message === API_CANCELED_ERROR) return;\n\n            dispatch({\n              type: ACTION_TYPES.ERROR,\n              payload: err?.response || err,\n            });\n            let _onError = config?.onError || onError;\n            await _onError(err);\n          })\n          .finally(async () => {\n            dispatch({ type: ACTION_TYPES.COMPLETE });\n            let _onComplete = config?.onComplete || onComplete;\n            await _onComplete();\n          });\n      })();\n    },\n    [asyncFunction, infinite, onComplete, onError, onStart, onSuccess, select]\n  );\n\n  const debounceExecute = useDebounce(execute, debounceTime, [\n    execute,\n    debounceTime,\n  ]);\n\n  const reset = useCallback(() => {\n    dispatch({ type: ACTION_TYPES.RESET });\n  }, []);\n\n  const cancel = useCallback(() => {\n    abortControllerRef?.current?.abort?.();\n  }, []);\n\n  useEffect(() => {\n    if (\n      !ignoreRef.current &&\n      status === ASYNC_STATUS.IDLE &&\n      immediate &&\n      enabled\n    ) {\n      execute();\n    }\n    return () => {\n      ignoreRef.current = true;\n    };\n  }, [enabled, execute, immediate, status]);\n\n  return useMemo(() => {\n    let values = {};\n\n    Object.keys(restMeta).forEach((key) => {\n      values[key] = restMeta[key];\n    });\n\n    return {\n      ...values,\n      data,\n      execute,\n      debounceExecute,\n      setQueryData,\n      error,\n      status,\n      isReset,\n      isComplete,\n      reset,\n      isIdle: status === ASYNC_STATUS.IDLE,\n      isPending: status === ASYNC_STATUS.PENDING,\n      isError: status === ASYNC_STATUS.ERROR,\n      isSuccess: status === ASYNC_STATUS.SUCCESS,\n      cancel,\n    };\n  }, [\n    cancel,\n    data,\n    debounceExecute,\n    error,\n    execute,\n    isComplete,\n    isReset,\n    reset,\n    restMeta,\n    setQueryData,\n    status,\n  ]);\n}\n"],"names":["debounce","func","wait","immediate","timeout","context","args","arguments","later","apply","callNow","clearTimeout","setTimeout","useDebounce","fn","time","dependencies","useCallback","FUNCTION_PLACEHOLDER","ASYNC_STATUS","IDLE","PENDING","SUCCESS","ERROR","ACTION_TYPES","START","COMPLETE","RESET","SET_DATA","API_CANCELED_ERROR","INITIAL_STATE","isReset","isComplete","status","data","error","asyncReducer","state","action","type","payload","updatedState","overwrite","_data","infinite","rest","restMeta","Error","useAsync","asyncFunction","_config","intialState","enabled","select","onError","onSuccess","onStart","onComplete","debounceTime","ignoreRef","useRef","abortControllerRef","useReducer","Object","assign","dispatch","setQueryData","execute","config","current","AbortController","_onStart","signal","then","res","paginate","_onSuccess","err","message","response","_onError","_onComplete","debounceExecute","reset","cancel","abort","useEffect","useMemo","values","keys","forEach","key","isIdle","isPending","isError","isSuccess"],"mappings":"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"}